%% ==============================================================================
%% Inference Pipeline Diagram
%% ==============================================================================
%% Source File:     specs/cognitive-core/inference-engine.md
%% Repository Path: diagrams/cognitive-core/inference/cognitive-inference-pipeline.png
%% Description:     Visualizes the inference pipeline with PARALLEL motor
%%                  evaluation: Sensory Cortex -> Parallel Motors -> Convergence
%%                  -> Simulation -> Oracle Selection.
%% ==============================================================================

graph TD
    %% Global Styles
    classDef input fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000;
    classDef sensory fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000;
    classDef motor fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000;
    classDef conv fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000;
    classDef action fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px,color:#000;
    classDef reject fill:#ffcdd2,stroke:#c62828,stroke-width:2px,color:#000;

    %% 1. Input Processing
    subgraph "1. Sensory Cortex"
        direction TB
        RawSignal[Raw Signal]:::input
        Context[Context Snapshot]:::input
        
        Carrier[Carrier Detection]:::sensory
        Pattern[Pattern Extraction]:::sensory
        Structure[Structure Analysis]:::sensory
        Semantics[Semantic Extraction]:::sensory
        
        RawSignal --> Carrier --> Pattern --> Structure --> Semantics
        Context --> Structure
    end

    %% 2. Parallel Motor Evaluation
    subgraph "2. Parallel Motor Evaluation (Simultaneous)"
        direction TB
        
        Dist{Distribute to<br/>All Motors}:::conv
        Semantics --> Dist
        
        Prax[Praxeological Motor]:::motor
        Nash[Nash Motor]:::motor
        Chaos[Chaotic Motor]:::motor
        Meta[Meristic Meta-Motor]:::motor
        
        Dist --> Prax & Nash & Chaos & Meta
        
        %% Scores
        SP["Score_P"]:::motor
        SN["Score_N"]:::motor
        SC["Score_C"]:::motor
        SM["Score_M"]:::motor
        
        Prax --> SP
        Nash --> SN
        Chaos --> SC
        Meta --> SM
    end

    %% 3. Convergence
    subgraph "3. Convergence & CP Calculation"
        direction TB
        
        Conv{Convergence<br/>Function}:::conv
        SP & SN & SC & SM --> Conv
        
        CP["CP = P x N x C x M"]:::conv
        Conv --> CP
        
        %% Veto Check
        Veto{Any score = 0?}:::reject
        CP --> Veto
        
        Veto -->|Yes| Reject[Reject: Veto Active]:::reject
        Veto -->|No| Proceed[Proceed with CP]:::action
    end

    %% 4. Simulation & Selection
    subgraph "4. Simulation & Selection"
        direction TB
        Sim[Multiverse Simulation]:::action
        Rank[Ranking by CP]:::action
        Select[Oracle Selection]:::action
        
        Proceed --> Sim --> Rank --> Select
    end

    %% 5. Output
    subgraph "5. Output"
        direction TB
        Gene[Selected Gene]:::action
        Trace[Rationale Trace]:::input
        
        Select --> Gene
        Select --> Trace
    end

    %% Annotations
    note1["PARALLEL, NOT SEQUENTIAL<br/>All motors evaluate simultaneously<br/>Product function ensures convergence"]:::conv -.-> Dist
