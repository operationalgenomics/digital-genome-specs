%% ==============================================================================
%% Cognitive Layered Architecture Diagram
%% ==============================================================================
%% Source File:     specs/cognitive-core/specification.md
%% Repository Path: diagrams/cognitive-core/architecture/cognitive-layered-architecture.png
%% Description:     Visualizes the four layers of the Cognitive Core: Input
%%                  Interpretation, Contextual Reasoning, Gene Selection, and
%%                  Evolution & Feedback, along with inputs (UNL, Context) and
%%                  outputs (Selected Gene, Explanation).
%% ==============================================================================

graph TD
    %% Global Styles
    classDef layer fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000;
    classDef input fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000;
    classDef output fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px,color:#000;
    classDef ext fill:#eeeeee,stroke:#212121,stroke-width:2px,color:#000;

    %% External Inputs
    subgraph Inputs [External Inputs]
        direction TB
        UNL[UNL Intent]:::input
        RawData[Raw Context Data]:::input
    end

    %% Layer 1: Input Interpretation
    subgraph L1 ["Layer 1: Input Interpretation"]
        direction TB
        IntentProc[Intent Processor]:::layer
        Norm[Context Normalizer]:::layer
        
        UNL --> IntentProc
        RawData --> Norm
    end

    %% Layer 2: Contextual Reasoning
    subgraph L2 ["Layer 2: Contextual Reasoning"]
        direction TB
        ContextEval[Context Evaluator]:::layer
        SafetyFilter{Safety Filter}:::layer
        
        Norm --> ContextEval
        IntentProc --> SafetyFilter
        ContextEval --> SafetyFilter
    end

    %% Layer 3: Gene Selection
    subgraph L3 ["Layer 3: Gene Selection Engine"]
        direction TB
        Inference[Inference Engine]:::layer
        Sim[Simulation Engine]:::layer
        Oracle[Oracle Synthesizer]:::layer
        
        SafetyFilter -->|Validated Intent| Inference
        Inference -->|Candidate Genes| Sim
        Sim -->|Worldline Results| Oracle
    end

    %% Layer 4: Evolution & Feedback
    subgraph L4 ["Layer 4: Evolution & Feedback"]
        direction TB
        Merism[Merism Evolution Engine]:::layer
        Fitness[Fitness Tracker]:::layer
        
        Oracle -.->|Outcome Data| Fitness
        Fitness --> Merism
    end

    %% Outputs
    subgraph Outputs [System Outputs]
        direction TB
        Gene[Selected Operational Gene]:::output
        Explain[Explanation Artifact]:::output
        Evolution[Evolution Proposal]:::output
    end

    %% Flow Connections
    Oracle --> Gene
    Oracle --> Explain
    Merism --> Evolution

    %% Feedback Loop
    Evolution -.->|Updates Genome| Inference

    %% Annotations
    note1["Layers operate sequentially for decisions<br/>but parallel for evolution"]:::ext -.-> L3
