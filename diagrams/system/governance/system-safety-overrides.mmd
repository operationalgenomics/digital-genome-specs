%% ==============================================================================
%% Safety Override Pathways Diagram
%% ==============================================================================
%% Source File:     specs/system/architecture-diagrams.md
%% Repository Path: diagrams/system/governance/system-safety-overrides.png
%% Description:     Depicts forced reinterpretation or execution constraints when:
%%                  alarms occur, dangerous states detected, or forbidden actions
%%                  attempted.
%% ==============================================================================

graph TD
    %% Global Styles
    classDef trigger fill:#ffcdd2,stroke:#c62828,stroke-width:2px,color:#000;
    classDef logic fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000;
    classDef action fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000;
    classDef result fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px,color:#000;
    classDef halt fill:#d50000,stroke:#b71c1c,stroke-width:3px,color:#fff;

    %% 1. Triggers (The Threat)
    subgraph "1. Threat Detection"
        direction TB
        Alarm[Active Alarm]:::trigger
        State[Dangerous State]:::trigger
        Forbidden[Forbidden Intent]:::trigger
        
        Note1["e.g., High Temp"]:::trigger -.-> Alarm
        Note2["e.g., Pressure > Max"]:::trigger -.-> State
        Note3["e.g., Open Interlock"]:::trigger -.-> Forbidden
    end

    %% 2. Override Logic (The Intervention)
    subgraph "2. Safety Override Logic"
        direction TB
        Monitor{Safety Monitor}:::logic
        Override{Override Engine}:::logic
        
        Alarm & State & Forbidden --> Monitor
        Monitor -->|Risk Detected| Override
    end

    %% 3. Pathways (The Response)
    subgraph "3. Response Pathways"
        direction TB
        
        %% Path A: Reinterpretation (Contextual Shift)
        Override -->|Context Shift| Reinterp[Forced Reinterpretation]:::action
        Reinterp -->|Modify Intent| NewIntent["New Intent: Diagnose/Safe-Mode"]:::result
        
        %% Path B: Constraint Injection (Soft Limit)
        Override -->|Parameter Limit| Constrain[Inject Constraints]:::action
        Constrain -->|Add Limits| SafePlan["Constrained Plan (Slow/Low-Power)"]:::result
        
        %% Path C: Hard Block (Safety Stop)
        Override -->|Violation| Block[Block Execution]:::halt
        Block -->|Trigger| Halt((Emergency Halt)):::halt
    end

    %% 4. Execution
    subgraph "4. Execution Layer"
        direction TB
        Exec[Execution Engine]:::action
        
        NewIntent --> Exec
        SafePlan --> Exec
        Halt -.->|Interrupt| Exec
    end

    %% Annotations
    note1["Context Model forces 'Inspect' to become 'Diagnose'<br/>when alarms are active"]:::action -.-> Reinterp
