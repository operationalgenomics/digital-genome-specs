graph TD
    %% Global Styles
    classDef input fill:#e0f7fa,stroke:#006064,stroke-width:2px,color:#000;
    classDef calc fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000;
    classDef genome fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px,color:#000;
    classDef logic fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000;
    classDef state fill:#eeeeee,stroke:#212121,stroke-width:2px,color:#000;

    %% 1. Input Data
    subgraph "1. Input Vectors"
        direction TB
        Outcome[Outcome Evaluation]:::input
        Sim[Simulation Baseline]:::input
        Time[Time Since Last Run]:::input
        
        Outcome -.->|Compare| Sim
    end

    %% 2. Calculation Engine
    subgraph "2. Fitness Calculator"
        direction TB
        Delta{Calculate Delta}:::calc
        
        %% Positive Factors
        Pos[Positive Factors]:::logic
        P1[Success Match]:::state
        P2[Performance Margin]:::state
        
        %% Negative Factors
        Neg[Negative Factors]:::logic
        N1[Deviations]:::state
        N2[Safety Incidents]:::state
        N3[Sim Mismatch]:::state
        
        %% Decay
        Decay[Temporal Decay]:::logic
        
        %% Wiring Logic
        Outcome --> Pos & Neg
        Time --> Decay
        
        Pos --- P1 & P2
        Neg --- N1 & N2 & N3
        
        Pos -->|Increase Score| Delta
        Neg -->|Decrease Score| Delta
        Decay -->|Reduce Score| Delta
    end

    %% 3. Genome Update
    subgraph "3. Genome Update"
        direction TB
        Gene[Operational Gene]:::genome
        Current[Current Score]:::genome
        New[New Score]:::genome
        
        Gene --> Current
        Current --> Delta
        Delta --> New
        New --> Gene
    end

    %% 4. Status Check
    subgraph "4. Lifecycle Evaluation"
        direction TB
        Check{Threshold Check}:::calc
        
        New --> Check
        
        Check -->|Score > Min| Active[Keep Active]:::state
        Check -->|Score < Min| Obs[Mark Obsolete]:::state
        Check -->|Critical Drop| Trig[Trigger Evolution]:::logic
    end

    %% Annotations
    note1[Safety failures carry<br/>highest penalty]:::logic -.-> N2
