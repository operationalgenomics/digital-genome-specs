%% ==============================================================================
%% Cognitive Oracle Funnel Diagram
%% ==============================================================================
%% Source File:     specs/cognitive-core/oracle-synthesizer.md
%% Repository Path: diagrams/cognitive-core/oracle/cognitive-oracle-funnel.mmd
%% Description:     Visualizes the Oracle's synthesis process: Aggregating raw 
%%                  simulation data from the Multiverse, filtering by risk/confidence,
%%                  and narrowing down to a single authoritative decision.
%% ==============================================================================

graph TD
    %% Global Styles
    classDef input fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000;
    classDef process fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000;
    classDef filter fill:#ffcdd2,stroke:#c62828,stroke-width:2px,color:#000;
    classDef output fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px,color:#000;
    classDef meta fill:#f3e5f5,stroke:#4a148c,stroke-width:1px,stroke-dasharray: 5 5,color:#000;

    %% 1. Input: Multiverse Data
    subgraph "1. Raw Simulation Data"
        direction TB
        Sims[Multiverse Results]:::input
        Note1["1000+ Worldlines"]:::meta
        
        Sims --- Note1
    end

    %% 2. The Oracle Funnel
    subgraph "2. The Synthesis Funnel"
        direction TB
        
        %% Stage 1: Aggregation
        Agg[Outcome Aggregator]:::process
        Sims --> Agg
        
        %% Stage 2: Risk Filtering
        Risk{Risk Filter}:::filter
        Agg --> Risk
        Risk -->|High Variance| Discard1[Reject: Unstable]:::filter
        Risk -->|Stable| Conf{Confidence Scorer}:::process
        
        %% Stage 3: Confidence Check
        Conf -->|Score < Threshold| Discard2[Reject: Low Confidence]:::filter
        Conf -->|Score > Threshold| Select[Final Selection]:::process
    end

    %% 3. Output: The Decision
    subgraph "3. Cognitive Response"
        direction TB
        Dec[Decision Object]:::output
        Rationale[Rationale Trace]:::output
        
        Select --> Dec
        Select --> Rationale
    end

    %% Annotations
    note2["'98% Success Rate in<br/>Standard & Stress Scenarios'"]:::meta -.-> Rationale
